{% extends 'md3/base.html' %}

{% block content %}
{% include 'md3-nav.html' %}
<div class="md3-page">
  <style>
    .wizard-container { max-width: 1280px; margin: 24px auto; padding: 0 16px; }
    .wizard-steps { display:flex; align-items:center; gap:12px; padding:12px 16px; border-radius:16px; }
    .wizard-step { display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background: var(--md-sys-color-surface); box-shadow: var(--md-sys-elevation-1); }
    .wizard-step .num { width:20px; height:20px; display:inline-flex; align-items:center; justify-content:center; border-radius:50%; background: var(--md-sys-color-primary); color: var(--md-sys-color-on-primary); font-size:12px; }
    .wizard-step.active { background: color-mix(in srgb, var(--md-sys-color-primary) 12%, var(--md-sys-color-surface)); }
    .wizard-card { padding: 16px; border-radius: 16px; }
    .table-wrap { overflow:auto; border-radius: 12px; }
    .md3-table thead th { position: sticky; top: 0; background: var(--md-sys-color-surface); z-index: 1; }
    @media (max-width: 900px) { .filter-line { gap: 6px; } }
  </style>
  <div class="wizard-container">
  <div class="md3-header" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
    <div>
      <div class="md3-title">Bestellassistent – Schritt 2/4</div>
      <div class="md3-subtitle">Artikel auswählen</div>
    </div>
  </div>

  <form method="post">
    {{ form.hidden_tag() }}

    <div class="md3-card wizard-steps" aria-label="Fortschritt" style="margin-bottom:12px;">
      <div class="wizard-step"><span class="num">1</span><span>Auswahl</span></div>
      <div class="wizard-step active"><span class="num">2</span><span>Artikel</span></div>
      <div class="wizard-step"><span class="num">3</span><span>Details</span></div>
      <div class="wizard-step"><span class="num">4</span><span>Abschluss</span></div>
    </div>

    <!-- Filter (optional simple version) -->
    <div class="md3-card wizard-card filter-line" style="margin-bottom:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
      {{ form.filter_name(placeholder='Artikelname', style='height:40px;border-radius:12px;border:1px solid var(--md-sys-color-outline-variant);padding:0 10px;background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface);') }}
      {{ form.filter_category(style='height:40px;border-radius:12px;border:1px solid var(--md-sys-color-outline-variant);padding:0 10px;background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface);') }}
      {{ form.filter_manufacturer(style='height:40px;border-radius:12px;border:1px solid var(--md-sys-color-outline-variant);padding:0 10px;background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface);') }}
      <button type="submit" name="filter" value="1" class="md3-button md3-button-tonal">Filtern</button>
    </div>

    <!-- Assets Tabelle -->
    <div class="md3-card wizard-card">
      <div class="table-wrap">
      <table class="md3-table" style="width:100%;border-collapse:separate;border-spacing:0 8px;min-width:800px;">
        <thead>
          <tr>
            <th style="text-align:left;padding:8px 12px;">Auswahl</th>
            <th style="text-align:left;padding:8px 12px;">Artikel</th>
            <th style="text-align:left;padding:8px 12px;">Menge</th>
            <th style="text-align:left;padding:8px 12px;">Seriennummer</th>
          </tr>
        </thead>
        <tbody>
        {% for i in range(form.assets|length) %}
          {% set sub = form.assets[i] %}
          {% set asset = (assets|selectattr('id', 'equalto', (sub.asset_id.data or 0)|int)|list|first) %}
          <tr class="md3-row" style="background:var(--md-sys-color-surface);box-shadow:var(--md-sys-elevation-1);border-radius:12px;">
            <td style="padding:8px 12px;vertical-align:middle;">
              {{ sub.asset_id }}
              {{ sub.select() }}
            </td>
            <td style="padding:8px 12px;">
              {% if asset %}
                <div><strong>{{ asset.name }}</strong></div>
                <div class="md3-subtitle">{{ asset.article_number or '-' }}</div>
              {% else %}
                <div><strong>Artikel #{{ sub.asset_id.data }}</strong></div>
              {% endif %}
            </td>
            <td style="padding:8px 12px;min-width:120px;">{{ sub.quantity(min=1, style='width:100px;height:40px;border-radius:12px;border:1px solid var(--md-sys-color-outline-variant);padding:0 10px;background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface);') }}</td>
            <td style="padding:8px 12px;min-width:220px;">{{ sub.serial_number(placeholder='optional', style='width:100%;height:40px;border-radius:12px;border:1px solid var(--md-sys-color-outline-variant);padding:0 10px;background:var(--md-sys-color-surface);color:var(--md-sys-color-on-surface);') }}</td>
          </tr>
        {% else %}
          <tr><td colspan="4" style="padding:12px;">Keine Artikel gefunden.</td></tr>
        {% endfor %}
        </tbody>
      </table>
      </div>
    </div>

    <div class="md3-toolbar" style="margin-top:16px;display:flex;gap:8px;justify-content:flex-end;">
      <a href="{{ url_for('md3_order.wizard_step1') }}" class="md3-button md3-button-text">Zurück</a>
      {{ form.submit(class='md3-button md3-button-filled') }}
    </div>
  </form>
  </div>
</div>
{% endblock %}

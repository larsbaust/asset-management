{% extends 'base.html' %}

{% block head %}
<style>
  .md3-result-header {
    background: var(--md-sys-color-surface-container-low);
    border-radius: var(--md-sys-shape-corner-large, 12px);
    padding: var(--md-sys-spacing-6, 24px);
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--md-sys-spacing-3, 12px);
    margin-bottom: var(--md-sys-spacing-4, 16px);
  }

  .md3-result-header.success {
    background: linear-gradient(135deg, var(--md-sys-color-primary) 0%, var(--md-sys-color-primary-container) 100%);
    color: var(--md-sys-color-on-primary);
  }

  .md3-result-header.error {
    background: linear-gradient(135deg, var(--md-sys-color-error) 0%, var(--md-sys-color-error-container) 100%);
    color: var(--md-sys-color-on-error);
  }

  .md3-status-message {
    padding: var(--md-sys-spacing-4, 16px);
    border-radius: var(--md-sys-shape-corner-medium, 8px);
    margin-bottom: var(--md-sys-spacing-4, 16px);
    display: flex;
    align-items: center;
    gap: var(--md-sys-spacing-3, 12px);
    font-weight: 500;
  }

  .md3-status-message.success {
    background: var(--md-sys-color-primary-container);
    color: var(--md-sys-color-on-primary-container);
  }

  .md3-status-message.error {
    background: var(--md-sys-color-error-container);
    color: var(--md-sys-color-on-error-container);
  }

  .md3-section-header {
    display: flex;
    align-items: center;
    gap: var(--md-sys-spacing-2, 8px);
    margin-bottom: var(--md-sys-spacing-4, 16px);
  }

  .md3-backup-file {
    font-family: 'Roboto Mono', monospace;
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-primary);
    padding: var(--md-sys-spacing-2, 8px);
    border-radius: var(--md-sys-shape-corner-small, 4px);
    border: 1px solid var(--md-sys-color-outline-variant);
    font-weight: 500;
    margin: var(--md-sys-spacing-2, 8px) 0;
  }

  .md3-help-text {
    color: var(--md-sys-color-on-tertiary-container);
    font-size: 0.875rem;
    margin-top: var(--md-sys-spacing-2, 8px);
  }

  .md3-actions {
    display: flex;
    gap: var(--md-sys-spacing-3, 12px);
    justify-content: center;
    margin-top: var(--md-sys-spacing-6, 24px);
    flex-wrap: wrap;
  }
</style>
{% endblock %}

{% block content %}
<!-- MD3 Navigation -->
<header class="md-nav-container">
  {% include 'md3-nav.html' %}
</header>

<div class="md3-page">
<div class="md3-container">
  <!-- Flash Messages handled by base.html -->

  <!-- Result Header -->
  <div class="md3-result-header {% if results.assets.success and results.orders.success and results.inventory.success %}success{% else %}error{% endif %}">
    <span class="material-symbols-outlined">
      {% if results.assets.success and results.orders.success and results.inventory.success %}
        check_circle
      {% else %}
        warning
      {% endif %}
    </span>
    <h1 class="md3-headline-medium">Daten-Reset Ergebnis</h1>
  </div>

  <!-- Status Message -->
  <div class="md3-status-message {% if results.assets.success and results.orders.success and results.inventory.success %}success{% else %}error{% endif %}">
    <span class="material-symbols-outlined">
      {% if results.assets.success and results.orders.success and results.inventory.success %}
        check_circle
      {% else %}
        warning
      {% endif %}
    </span>
    <div>
      {% if results.assets.success and results.orders.success and results.inventory.success %}
        <strong>ERFOLG!</strong> Die Daten wurden erfolgreich zurückgesetzt.
      {% else %}
        <strong>WARNUNG:</strong> Es sind Fehler beim Zurücksetzen aufgetreten.
      {% endif %}
    </div>
  </div>

  <!-- Backup Section -->
  <div class="md3-card">
    <div class="md3-section-header">
      <span class="material-symbols-outlined">backup</span>
      <h2 class="md3-headline-small">Backup</h2>
    </div>
    <div class="md3-chip md3-chip-outlined">
      <p>Ein Backup der Datenbank wurde erstellt, bevor Daten gelöscht wurden.</p>
      <div class="md3-backup-file">{{ results.backup }}</div>
      <div class="md3-help-text">
        Diese Datei befindet sich im Verzeichnis "backups" der Anwendung und kann bei Bedarf wiederhergestellt werden.
      </div>
    </div>
  </div>

  <!-- Assets Section -->
  <div class="md3-card">
    <div class="md3-section-header">
      <span class="material-symbols-outlined">inventory_2</span>
      <h2 class="md3-headline-small">Gelöschte Assets</h2>
    </div>
    {% if results.assets.success %}
      {% if results.assets.deleted|length > 0 %}
        {% for table, count in results.assets.deleted.items() %}
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--md-sys-spacing-2, 8px);">
            <span>{{ table }}</span>
            <span class="md3-chip md3-chip-outlined">{{ count }}</span>
          </div>
        {% endfor %}
      {% else %}
        <div class="flash-message flash-info">
          <span class="material-symbols-outlined" style="font-size: 1.5rem;">inventory_2</span>
          <p>Keine Assets zum Löschen gefunden.</p>
        </div>
      {% endif %}
    {% else %}
      <div class="flash-message flash-error">
        <span class="material-symbols-outlined">error</span>
        <div>
          <strong>Fehler beim Zurücksetzen der Assets:</strong><br>
          {{ results.assets.error }}
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Orders Section -->
  <div class="md3-card">
    <div class="md3-section-header">
      <span class="material-symbols-outlined">shopping_cart</span>
      <h2 class="md3-headline-small">Gelöschte Bestellungen</h2>
    </div>
    {% if results.orders.success %}
      {% if results.orders.deleted|length > 0 %}
        {% for table, count in results.orders.deleted.items() %}
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--md-sys-spacing-2, 8px);">
            <span>{{ table }}</span>
            <span class="md3-chip md3-chip-outlined">{{ count }}</span>
          </div>
        {% endfor %}
      {% else %}
        <div class="flash-message flash-info">
          <span class="material-symbols-outlined" style="font-size: 1.5rem;">shopping_cart</span>
          <p>Keine Bestellungen zum Löschen gefunden.</p>
        </div>
      {% endif %}
    {% else %}
      <div class="flash-message flash-error">
        <span class="material-symbols-outlined">error</span>
        <div>
          <strong>Fehler beim Zurücksetzen der Bestellungen:</strong><br>
          {{ results.orders.error }}
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Inventory Section -->
  <div class="md3-card">
    <div class="md3-section-header">
      <span class="material-symbols-outlined">inventory</span>
      <h2 class="md3-headline-small">Gelöschte Inventurdaten</h2>
    </div>
    {% if results.inventory.success %}
      {% if results.inventory.deleted|length > 0 %}
        {% for table, count in results.inventory.deleted.items() %}
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--md-sys-spacing-2, 8px);">
            <span>{{ table }}</span>
            <span class="md3-chip md3-chip-outlined">{{ count }}</span>
          </div>
        {% endfor %}
      {% else %}
        <div class="flash-message flash-info">
          <span class="material-symbols-outlined" style="font-size: 1.5rem;">inventory</span>
          <p>Keine Inventurdaten zum Löschen gefunden.</p>
        </div>
      {% endif %}
    {% else %}
      <div class="flash-message flash-error">
        <span class="material-symbols-outlined">error</span>
        <div>
          <strong>Fehler beim Zurücksetzen der Inventurdaten:</strong><br>
          {{ results.inventory.error }}
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Optional Results Section -->
  {% if results.get('suppliers') or results.get('locations') or results.get('manufacturers') or results.get('assignments') %}
    <div style="margin-top: var(--md-sys-spacing-6, 24px); padding-top: var(--md-sys-spacing-6, 24px); border-top: 1px solid var(--md-sys-color-outline-variant);">
      <div class="md3-section-header">
        <span class="material-symbols-outlined">tune</span>
        <h2 class="md3-headline-medium">Optionale Stammdaten</h2>
      </div>

      <!-- Suppliers -->
      {% if results.get('suppliers') %}
        <div class="md3-card">
          <div class="md3-section-header">
            <span class="material-symbols-outlined">store</span>
            <h3 class="md3-headline-small">Lieferanten</h3>
          </div>
          {% if results.suppliers.success %}
            <div class="flash-message flash-success">
              <span class="material-symbols-outlined">check_circle</span>
              <span>{{ results.suppliers.deleted }} Lieferanten erfolgreich gelöscht</span>
            </div>
          {% else %}
            <div class="flash-message flash-error">
              <span class="material-symbols-outlined">error</span>
              <div>Fehler: {{ results.suppliers.error }}</div>
            </div>
          {% endif %}
        </div>
      {% endif %}
    </div>
  {% endif %}

  <!-- Actions -->
  <div class="md3-actions">
    <a href="{{ url_for('admin.backup_restore', md3=1) }}" class="md3-button md3-button-outlined">
      <span class="material-symbols-outlined">arrow_back</span>
      Zurück zu Backup & Wiederherstellung
    </a>
    <a href="/md3/assets" class="md3-button md3-button-filled">
      <span class="material-symbols-outlined">inventory_2</span>
      Assets verwalten
    </a>
  </div>
</div>
</div>
{% endblock %}
